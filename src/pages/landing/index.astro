---
// src/pages/landing.astro
import Layout from '@/layouts/Layout.astro';
const currentUrl = Astro.url;
---

<Layout canonicalUrl={currentUrl}>
  <head>
    <!-- Importing fonts from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&family=Space+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <main
    class="page-container fixed top-0 left-0 w-screen h-screen overflow-hidden bg-black"
  >
    <!-- Layer for the overlapping images -->
    <div class="image-layers absolute inset-0 z-10">
      <!-- Black and White Image (Bottom Layer) -->
      <div class="image-bg bw-image"></div>
      <!-- Color Image (Top Layer, clipped) -->
      <div class="image-bg color-image"></div>
    </div>

    <!-- Central Name/Logo -->
    <div
      class="central-logo absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 text-center pointer-events-none"
    >
      <h2
        class="text-white text-2xl md:text-3xl font-bold font-custom tracking-wider"
      >
        PRAMUDITHA
      </h2>
      <p class="text-white/70 text-sm">Full-Stack Developer</p>
    </div>

    <!-- Interaction Layer (sits on top of everything) -->
    <div class="interaction-layer absolute inset-0 z-30 flex">
      <!-- Left Section Link (Transparent Hover Target) -->
      <a href="/about" class="group section-link designer-section">
        <div class="content">
          <h1 class="title">DESIGNER</h1>
          <span class="cta">
            View Work
            <span class="arrow">&rarr;</span>
          </span>
        </div>
      </a>
      <!-- Right Section Link (Transparent Hover Target) -->
      <a href="/projects" class="group section-link coder-section">
        <div class="content">
          <h1 class="title font-mono">&lt;CODER&gt;</h1>
          <span class="cta">
            See Projects
            <span class="arrow">&rarr;</span>
          </span>
        </div>
      </a>
    </div>
  </main>

  <style>
    /* Custom fonts */
    .font-custom {
      font-family: 'Poppins', sans-serif;
    }
    .font-mono {
      font-family: 'Space Mono', monospace;
    }

    /* Base styles for the image layers */
    .image-bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      /* Add a transition for the parallax movement */
      transition: background-position 0.1s ease-out;
    }

    /* !! IMPORTANT !! Image URLs for the backgrounds */
    .color-image {
      /* This is your full-color image */
      background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('public/Images/Developer.png');
      z-index: 2;
      /* CORE LOGIC: Initially show only the left 50% of this top image */
      clip-path: inset(0 50% 0 0);
      /* Add transition for the reset animation on mouseleave */
      transition: clip-path 0.5s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .bw-image {
      /* This is your black-and-white image, fully visible underneath */
      background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('public/Images/Designer.png');
      z-index: 1;
    }
    /* --- End of important section --- */


    /* Interaction links styling (Transparent hover targets) */
    .section-link {
      display: flex;
      justify-content: center;
      align-items: center;
      flex: 1; /* Each link takes up 50% of the space */
      text-decoration: none;
      height: 100%;
      position: relative;
    }

    /* CSS hover animations for clip-path have been removed */

    /* Content wrapper inside the link */
    .content {
      text-align: center;
      color: white;
      position: relative;
      z-index: 1;
      /* Initial state for the animation */
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
    }
    
    /* Reveal content on hover */
    .section-link:hover .content {
        opacity: 1;
        transform: scale(1);
        transition-delay: 0.2s; 
    }


    /* Main title styles */
    .title {
      font-size: clamp(2.5rem, 6vw, 5rem);
      font-weight: 900;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    /* "Call to Action" text styles */
    .cta {
      display: inline-block;
      margin-top: 1rem;
      font-size: 1.125rem;
      color: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 0.5rem 1.5rem;
      border-radius: 9999px;
      transition: all 0.4s ease;
      backdrop-filter: blur(5px);
    }

    .group:hover .cta {
      background-color: white;
      color: black;
      border-color: white;
    }

    /* Arrow styling */
    .arrow {
      display: inline-block;
      margin-left: 0.5rem;
      transition: transform 0.4s ease;
    }

    .group:hover .arrow {
      transform: translateX(5px);
    }

    /* Central logo fade on hover */
    .central-logo {
        transition: opacity 0.5s ease;
    }
    .interaction-layer:hover ~ .central-logo {
        opacity: 0;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Explicitly type the elements as HTMLElement or null
      const colorImage: HTMLElement | null = document.querySelector('.color-image');
      const bwImage: HTMLElement | null = document.querySelector('.bw-image');
      const pageContainer: HTMLElement | null = document.querySelector('.page-container');
      
      // The guard clause correctly handles the case where elements might not be found
      if (!colorImage || !bwImage || !pageContainer) return;

      const parallaxIntensity = 20; // How many pixels the image will move.
      // A smaller value creates a more noticeable delay/smoothing effect.
      const lerpFactor = 0.01; 

      let targetX = window.innerWidth / 2;
      let currentX = window.innerWidth / 2;
      let isMouseOver = false;

      // --- 1. Animation Loop ---
      function animate() {
        // If mouse is not over the container, smoothly move back to center
        if (!isMouseOver) {
          targetX = window.innerWidth / 2;
        }

        // Lerp for smooth motion
        currentX += (targetX - currentX) * lerpFactor;

        // --- 2. Reveal Logic ---
        const clipPercentage = (currentX / window.innerWidth) * 100;
        // Remove transition to let JS handle the animation smoothly
        if (colorImage) {
          colorImage.style.transition = 'none';
          colorImage.style.clipPath = `inset(0 ${100 - clipPercentage}% 0 0)`;
        }

        // --- 3. Horizontal-Only Parallax Logic ---
        const xOffset = (currentX / window.innerWidth) - 0.5;
        const xParallax = -xOffset * parallaxIntensity;
        const parallaxPosition = `calc(50% + ${xParallax}px) 50%`; // Y is always 50%
        
        if (colorImage) colorImage.style.backgroundPosition = parallaxPosition;
        if (bwImage) bwImage.style.backgroundPosition = parallaxPosition;
        
        requestAnimationFrame(animate);
      }
      
      // --- 4. Event Listeners ---
      // Explicitly type the event as a MouseEvent to access clientX
      pageContainer.addEventListener('mousemove', (e: MouseEvent) => {
        targetX = e.clientX;
      });
      
      pageContainer.addEventListener('mouseenter', () => {
          isMouseOver = true;
      });

      pageContainer.addEventListener('mouseleave', () => {
          isMouseOver = false;
          // Re-apply CSS transition for smooth reset animation
          colorImage.style.transition = 'clip-path 0.5s cubic-bezier(0.23, 1, 0.32, 1)';
      });

      // Start the animation loop
      animate();
    });
  </script>
</Layout>
